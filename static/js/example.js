// Generated by CoffeeScript 1.6.3
(function() {
  var beforeSubmitExample, highlightLine, myCodeMirror, receiveErrorExample, receiveResponseExample;

  myCodeMirror = {};

  $(document).ready(function() {
    var codeMirrorConfig, codeMirrorTheme, myTextArea, start_code;
    myTextArea = document.getElementById('example');
    start_code = $('#example').text();
    codeMirrorTheme = $('meta[name="CodeMirrorTheme"]').attr('content');
    codeMirrorConfig = {
      'theme': codeMirrorTheme,
      'lineNumbers': true,
      'mode': 'clike',
      'indentUnit': 4,
      'value': start_code,
      'autofocus': true
    };
    myCodeMirror = CodeMirror.fromTextArea(myTextArea, codeMirrorConfig);
    $('#output').hide();
    $('#cmpinfo').hide();
    $('input#submit-test').click(function(e) {
      var request;
      e.preventDefault();
      return request = $.ajax({
        url: document.URL,
        type: 'POST',
        data: {
          'action': 'test',
          'code': myCodeMirror.getValue()
        },
        dataType: 'application/json',
        beforeSend: beforeSubmitExample,
        success: receiveResponseExample,
        error: receiveErrorExample
      });
    });
    return $('input#reset').click(function(e) {
      e.preventDefault();
      myCodeMirror.setValue(start_code);
      return false;
    });
  });

  beforeSubmitExample = function() {
    document.getElementById('submit-test').disabled = true;
    document.getElementById('reset').disabled = true;
    document.getElementById('input').disabled = true;
    $('#output').hide();
    $('#cmpinfo').hide();
    return $('#message').text("Submitting...");
  };

  receiveResponseExample = function(data) {
    var response;
    response = JSON.parse(data);
    if (response.cmpinfo != null) {
      $('#cmpinfo').show();
      $('#cmpinfo').find('div.code').html(response.cmpinfo);
    }
    if (response.output != null) {
      $('#output').show();
      $('#output').find('div.code').html(response.output);
    }
    document.getElementById('submit-test').disabled = false;
    document.getElementById('reset').disabled = false;
    document.getElementById('input').disabled = false;
    return $('#message').html(response.message);
  };

  receiveErrorExample = function(jqXHR, textStatus, errorThrown) {
    document.getElementById('submit-test').disabled = false;
    document.getElementById('reset').disabled = false;
    document.getElementById('input').disabled = false;
    return $('#message').text("Site Error: " + textStatus + " - " + errorThrown);
  };

  highlightLine = function(lineNumber) {
    var actualLineNumber, codeMirrorEditor, myEditor;
    actualLineNumber = lineNumber - 1;
    myEditor = $("#body_EditorSource .CodeMirror");
    console.log(myEditor);
    console.log(myEditor[0]);
    console.log(myEditor.CodeMirror);
    codeMirrorEditor = myEditor[0].CodeMirror;
    return codeMirrorEditor.setLineClass(actualLineNumber, 'background', 'codemirror-error');
  };

}).call(this);
